$(function(e){function t(){var t=b;console.log(t);var o={set:t};e.ajax({url:"accessRelationship.php",type:"post",cache:!1,dataType:"json",data:{data:o},beforeSend:function(){e.blockUI({message:'<div class="loader col-center"></br></div><p>Processing...</p>'})},success:function(t){if(e.unblockUI(),1==t.response){c=t.para_id,u=t.left_relations;var o=t.question_category,a=t.total,i=t.p_text;null==i&&(i=""),0!=c&&0!=u&&(e("#paragraph_text").prop("disabled","disabled"),e("#question_type").prop("disabled","disabled"),e("#question_category_type").prop("disabled","disabled"),e("#question_related").prop("disabled","disabled"),e("#question_type option:eq(1)").prop("selected",!0),e("#question_category_type").val(o),e("#question_related").val(a),e("#special_questions").removeClass("hide"),e("#paragraph").removeClass("hide")),tinymce.init({selector:"#paragraph_text",theme:"modern",plugins:["lists charmap preview hr","fullscreen insertdatetime nonbreaking","table contextmenu directionality template paste textcolor autoresize fullscreen"],autoresize_bottom_margin:50,autoresize_max_height:450,autoresize_min_height:150,toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | preview fullpage | forecolor backcolor",relative_urls:!1,init_instance_callback:function(e){e.setContent(i)}})}},error:function(e){console.log(JSON.stringify(e))}})}function o(){var t=tinyMCE.get("question_solution").getContent(),o=tinyMCE.get("question_text").getContent(),a=/^(0*[1-9][0-9]*(\.[0-9]+)?|0+\.[0-9]*[1-9][0-9]*)$/,r=e("#question_negative"),s=e("#question_positive"),n=e("#question_no option:selected"),l=e("#option_text_1"),p=e("#option_text_2"),m=e("#option_text_3"),f=e("#option_text_4"),b=e("#direction_text");if(e('input[name="option"]').is(":checked"))var y=e('input[name="option"]:checked'),q=y.attr("id").split("opt_"),x=q[1];var w=e("#question_category_type option:selected"),C=e("#question_type option:selected"),A=-1,k=e("#image_required option:selected"),S=s.val().trim(),P=r.val().trim(),T=e("#paper_set").val(),D=e("#paper_language").val(),z=l.val().trim(),B=p.val().trim(),I=m.val().trim(),O=f.val().trim(),j=b.val().trim(),M=0,N=0;d.html("Server Response");if(1==k.val()){if(!i())return alert("Image is not inserted"),!1;N=1}for(var U=1;6>=U;U++)if(U==x){A=U;break}if(!a.test(S))return alert("Please enter valid positive marks for question."),!1;if(!a.test(S))return alert("Please enter valid negative marks for question."),!1;if(o.length<1)return alert("Please provide the question"),!1;if(z.length<1)return alert("Please provide the option 1."),!1;if(B.length<1)return alert("Please provide the option 2."),!1;if(I.length<1)return alert("Please provide the option 3."),!1;if(O.length<1)return alert("Please provide the option 4."),!1;if(-1==A)return alert("No correct answer is selected."),!1;if(-1==w.val())return alert("Choose correct question type."),!1;if(t.length<1)return alert("Please provide the solution."),!1;e("#question_no").prop("disabled","disabled"),e("#question_positive").prop("disabled","disabled"),e("#question_negative").prop("disabled","disabled");var E={negative:P,positive:S,question:n.val(),question_text:o,option_1:z,option_2:B,option_3:I,option_4:O,directions:j,opt_flag:M,img:N,language:D,set:T,para_count:u,answer:A,category:w.val(),solution:t,type:C.val()};if(5==g){var J=e("#option_text_5");if(J.val().length<1)return alert("Please provide the option 5."),!1;var F=J.val().trim();E.option_5=F,E.opt_flag=1}else if(6==g){var J=e("#option_text_5"),R=e("#option_text_6");if(J.val().length<1||R.val().length<1)return alert("Please provide the option 5 or 6."),!1;var F=J.val().trim(),Q=R.val().trim();E.option_5=F,E.option_6=Q,E.opt_flag=2}if(1!=C.val()){var G=tinyMCE.get("paragraph_text"),H=G.getContent(),K=e("#question_related").val().trim();if(H.length<1)return alert("Please provide the passage details."),!1;if(null==K||_.test(K))return alert("Please insert correct number of question related to paragraph."),!1;E.paragraph=H,E.paragraph_questions=K,E.paragraph_id=c}return v=1,h+=parseInt(S),E}function a(){d.html("Add New Question Type");p.html('<input class="form-control" placeholder="write your new type here..." id="new_question_type"/>'),l.modal("show"),f=1}function i(){var t=!1;if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return p.html("Please upgrade your browser, because your current browser lacks some new features we need!"),l.modal("show"),!1;if(!e("[name=question_images]").val())return p.html('<p class="text-color-text-red">Insert a Image</p>'),l.modal("show"),!1;var o=e("[name=question_images]")[0].files[0].size,a=e("[name=question_images]")[0].files[0].type;switch(a){case"image/jpeg":break;case"image/png":break;case"image/jpg":break;default:return p.html("<b>"+a+'</b><p class="text-color-text-red">Unsupported file type!(your file should be in jpeg format.)</p>'),l.modal("show"),!1}if(o>4194304)return p.html("<b>"+r(o)+"</b> Too big Image file! <br />The maximum allowed size is : 4MB "),l.modal("show"),!1;var i=e("#form_images"),s=e("#paper_set").val(),n=e("#question_no option:selected").val();return e('[name="question_image"]').val("question_image_"+s+"_"+n),e.ajax({url:"imageProcess.php",type:"POST",data:new FormData(i[0]),contentType:!1,cache:!1,processData:!1,async:!1,success:function(e){t=!0},error:function(){console.log("err")}}),t}function r(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Bytes";var o=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,o),2)+" "+t[o]}function s(t){if(t.files&&t.files[0]){var o=new FileReader;o.onload=function(t){e("#show_image").attr("src",t.target.result)},o.readAsDataURL(t.files[0])}}function n(e){window.location.replace(e)}var l=e("#msgBox"),p=e("#msgText"),d=e("#msgTitle"),u=0,c=0,m=e("#question_no option:selected").val(),g=4,_=/\D/g,h=0,f=0,v=0,b=document.getElementById("set").value;t(),e("#question_type").on("change",function(t){t.preventDefault();var o=e("#question_type option:selected"),a=e("#special_questions"),i=e("#paragraph"),r=o.val();a.val(),i.val();1==r?(a.addClass("hide"),i.addClass("hide")):(i.removeClass("hide"),a.removeClass("hide"))}),e("#image_required").on("change",function(t){t.preventDefault();var o=e("#image_required option:selected"),a=o.val();console.log(a),0==a?(e("#images").addClass("hide"),e("#question_images").val(""),e("#show_image").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABA‌​AACAUwAOw==")):e("#images").removeClass("hide")}),e("#options").on("change",function(t){t.preventDefault();var o=e("#options option:selected"),a=e("#option_5"),i=e("#option_6");g=o.val(),5==g?(a.removeClass("hide"),i.addClass("hide")):6==g?(a.removeClass("hide"),i.removeClass("hide")):(a.addClass("hide"),i.addClass("hide"))}),e("#question_category_type").on("change",function(t){t.preventDefault();var o=e("#question_category_type option:selected"),i=o.val();-1==i&&a()}),e("#msgOK").on("click",function(t){if(t.preventDefault(),f){var o=e("#new_question_type"),a=o.val().trim().toUpperCase();if(null==a||""==a)return p.append('<p class="text-color-text-red">This type can not be added!</p>'),!1;e("#question_category_type").append("<option selected value="+a+">"+a+"</option>"),o.val("")}}),e("#msgCancel").on("click",function(e){return e.preventDefault(),!1}),e(".modal").on("hidden.bs.modal",function(){d=e("#msgTitle"),d.html("Attention!!!"),p.html(""),f=0}),e("#save").on("click",function(t){t.preventDefault();var a=o();v&&e.ajax({url:"processQuestions.php",type:"POST",dataType:"JSON",data:{paper:a},cache:!1,beforeSend:function(){e(".bottom-tab").addClass("hide"),e("#loader").removeClass("hide")},success:function(t){e(".bottom-tab").removeClass("hide"),e("#loader").addClass("hide"),11==t.response&&0==t.p_response&&0==c?(p.html('<p class="text-color-text-green">Successfully Added</p>'),l.modal("show"),m++,e('form[name="question_paper_2"]')[0].reset(),e("#form_images")[0].reset(),e("#question_no").append("<option selected value="+m+">"+m+"</option>")):11!=t.response||9!=t.p_response&&0==c?(p.html('<p class="text-color-text-red">'+JSON.stringify(t.error)+"</br>There are some Successive Errors</p>"),l.modal("show")):(0==c&&(c=t.para_id,u=t.para_count,e("#paragraph_text").prop("disabled","disabled"),e("#question_type").prop("disabled","disabled"),e("#question_category_type").prop("disabled","disabled"),e("#question_related").prop("disabled","disabled")),m++,u--,0==u?(e("#paragraph_text").prop("disabled",!1),e("#question_type").prop("disabled",!1),e("#question_category_type").prop("disabled",!1),e("#question_related").prop("disabled",!1),e("#paragraph").addClass("hide"),e("#special_questions").addClass("hide"),e('form[name="question_paper_2"]')[0].reset(),e("#form_images")[0].reset(),c=0):e('form[name="question_paper"]')[0].reset(),p.html('<p class="text-color-text-green">Successfully Added</p>'),l.modal("show"),e("#question_no").append("<option selected value="+m+">"+m+"</option>")),v=0},error:function(t){e(".bottom-tab").removeClass("hide"),e("#loader").addClass("hide"),p.html('<p class="text-color-text-red">'+JSON.stringify(t[0])+"</br>There are some Errors</p>"),l.modal("show"),console.log(JSON.stringify(t)),v=0},timeout:1e4})}),e("#done").on("click",function(t){t.preventDefault();var o=b,a={total:m-1,category:o,marks:h};e.ajax({url:"processFinalPaper.php",type:"POST",dataType:"JSON",data:{paper:a},cache:!1,beforeSend:function(){e.blockUI()},success:function(t){if(1==t.response){p.html('<div class="text-center"><p class="text-color-text-green">Paper Has Been Added Successfully</br>You will be redirected.In 3 Seconds.</p><p class="loader col-center"></p></div>'),l.modal("show");setTimeout(function(){n(t.url)},3e3)}else e.unblockUI(),p.html('<p class="text-color-text-red">Failed: Some error occured</p>'),l.modal("show"),console.log(JSON.stringify(err))},error:function(t){e.unblockUI(),1==t.response?(p.html('<p class="text-color-text-yellow">Paper Has Been Added Successfully</br>Some Error occured.</p>'),l.modal("show")):(p.html('<p class="text-color-text-red">Error: Some error occured</p>'),l.modal("show")),console.log(JSON.stringify(t))},timeout:1e4})}),e("#edit").on("click",function(t){t.preventDefault(),e("#question_no").prop("disabled",!1),e("#question_positive").prop("disabled",!1),e("#question_negative").prop("disabled",!1),e("#paragraph").prop("disabled",!1)}),e("#cancel").on("click",function(t){t.preventDefault(),e("#paragraph_text").val(""),e("#paragraph").addClass("hide"),0==u&&e("#special_questions").addClass("hide"),e('form[name="question_paper"]')[0].reset(),e('form[name="question_paper_2"]')[0].reset(),e("#question_no").prop("disabled","disabled"),e("#question_positive").prop("disabled","disabled"),e("#question_negative").prop("disabled","disabled")}),e("#question_images").on("change",function(){s(this)}),tinymce.init({selector:"#question_text",theme:"modern",plugins:["lists charmap preview hr","fullscreen insertdatetime nonbreaking","table contextmenu directionality template paste textcolor autoresize fullscreen"],autoresize_bottom_margin:50,autoresize_max_height:450,autoresize_min_height:150,toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | preview fullpage | forecolor backcolor"}),tinymce.init({selector:"#question_solution",theme:"modern",plugins:["lists charmap preview hr","fullscreen insertdatetime nonbreaking","table contextmenu directionality template paste textcolor autoresize fullscreen"],autoresize_bottom_margin:50,autoresize_max_height:450,autoresize_min_height:150,toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | preview fullpage | forecolor backcolor"})});